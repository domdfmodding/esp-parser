# stdlib
from io import BytesIO

# 3rd party
from coincidence.regressions import AdvancedDataRegressionFixture

# this package
from esp_parser.records import ACHR
from esp_parser.subrecords import PositionRotation


def test_achr_record(advanced_data_regression: AdvancedDataRegressionFixture):
	achr = ACHR(
			flags=1024,
			id=b'\x143\x00\x05',
			revision=0,
			version=15,
			unknown=b'\x00\x00',
			data=[
					ACHR.NAME(b"\x99'\x00\x05"),
					ACHR.XRGD(
							b"\x02\x00\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00]\xeb\x7f\xbfC5p>\xfcs\xf0\xbf\x08\x02\x03\x00\x00\x00\x03?\x00\x00@=\x00\xb0\xd9@B\x1c>@&k_\xbck\x82\x16@\t\x02\x02\x00\x00\x08\x00B\x00\x00\x1e>\x00\x00\x00=\xcb\xee\x7f<\x8dv\x8d\xbb\xdc:\xed?\n\x00\x02\x00\x00S\xe4A\x00\x00\xb0=\x00\x00\x1c>\x82`\x84<\x91\x8f\xaf\xbc\xf1y\x05?\x0e\x00\x01\x00\x00\x00\xe2\xbe\x00\x00\xca>\x00(\xde\xc0;\xa65@\xeb\xe4Q=\xbeC\x15\xc0\x0f\x00\x00\x00\x00\xea\xfeA\x00\x00L\xbe\x00\x00\xd0\xbd1\x0fg=\r\xae,\xbb\xe0[\x15@\x10\x00\x00\x00\x00\xf0\xe7A\x00\x00\xc0<\x00\x00\xdc\xbd\xb9$\xb1\xbc\x83F\x99=H\xe6\x15?\x02\x00\x00\x00\x00\x00\xbc?\x00\x00`<\x00\x00\xc6@\xb6k\xd9?ylW\xbe\x9f\xe9\xd5?\x03\x00\x00\x00\x00 \xef@\x00\x00\xe0\xbc\x00\x00\xa0;\xb8sB>\x06Z\xa5\xbe\x8e\xc7\x9a\xbc\x04\x00\x00\x00\x00\x80\x10A\x00\x00@\xbc\x00\x00@;\xda\xc8j>\xff\xe0\x9f\xbe++\x1a\xbd\x00\x00\x00\x00\x00\x00\x18?\x00\x00\x14\xbe\x00\x00 =\xa0\x81\x82=YE\x9d\xbc\x08\x17\x18\xbf\x01\x00\x00\x00\x00(\xb2@\x00\x00\x80<\x00\x00\x00<\xf8-\x92=o\xb96\xbe\x19\xd3\x1d?\x05\x00\x00\x00\x00\xd4,A\x00\x00\n?\x00@F@$\xe5R\xbf'u\x95\xbeq~\xd7>\x06\x00\x00\x00\x00\xcc\x9cA\x00\x00\x10=\x00\x00@\xbdVM\x83>\xcf\xd7\xc7\xbc\x84\xf9\x9d>\x07\x00\x00\x00\x00h\x81A\x00\x00\x80\xbd\x00\x00\x94=aA\xe7?\x9c\x174\xbd\xf5\xf3\x13\xbf\x0b\x00\x00\x00\x00\x980A\x00\x00D>\x00\x00\x1e\xc0\xb2~\xe7>\xe5X\xc7>X~q\xbc\x0c\x00\x00\x00\x00`\x9dA\x00\x00\xc0\xbd\x00\x00@;\xf9\xa8\x88\xbea`\xb2<&\x85\x08>\r\x00\x00\x00\x00\xd8\x81A\x00\x00\xe0\xbc\x00\x00\xe0\xbc'\x88\xee\xbf\xb6\xc2\xb2=\xdd\xc0\xae\xbd"
							),
					ACHR.XRGB(b'\x00\x00\x00\x80\x00\x00\x00\x80\xe7\x0f\xc9\xbf'),
					PositionRotation.DATA(
							xp=-69202.640625, yp=16929.505859375, zp=9522.4404296875, xr=0.0, yr=0.0, zr=0.0
							)
					]
			)
	advanced_data_regression.check(achr.unparse())

	buffer = achr.unparse()
	advanced_data_regression.check(buffer)
	assert achr.parse(BytesIO(buffer)) == achr
